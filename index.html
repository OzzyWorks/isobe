<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á£ØËæ∫„ÅÆÊµ∑„ÅØ„ÄÅ„Éõ„É¢„ÇΩ„Éº„Ç∑„É£„É´„Å™È¶ô„Çä„Åå„Åô„Çã„ÄÇ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        .pixel-font {
            font-family: 'DotGothic16', sans-serif;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.8s ease-out forwards; }
        .animate-slide-up { animation: slide-up 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // Static Images
        const STATIC_IMAGES = {
            CLUB_ROOM: "https://images.unsplash.com/photo-1519452635265-7b1fbfd1e4e0?auto=format&fit=crop&q=80&w=1200",
            HARBOR: "https://images.unsplash.com/photo-1516939884455-1445c8652f83?auto=format&fit=crop&q=80&w=1200",
            WATARU: "https://images.unsplash.com/photo-1529665253569-6d01c0eaf7b6?auto=format&fit=crop&q=80&w=400",
            GOU: "https://images.unsplash.com/photo-1488161628813-04466f872be2?auto=format&fit=crop&q=80&w=400",
            MISAKI: "https://images.unsplash.com/photo-1473448912268-2022ce9509d8?auto=format&fit=crop&q=80&w=400",
            SHADOW: "https://images.unsplash.com/photo-1509248961158-e54f6934749c?auto=format&fit=crop&q=80&w=400"
        };

        // BGM URLs (Ëëó‰ΩúÊ®©„Éï„É™„ÉºÈü≥Ê∫ê from Pixabay)
        const BGM_URLS = {
            MAIN: "https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3",
        };

        const getStaticImage = (key) => {
            return STATIC_IMAGES[key] || STATIC_IMAGES.HARBOR;
        };

        // Image Prompts
        const IMAGE_PROMPTS = {
            CLUB_ROOM: "CLUB_ROOM",
            HARBOR: "HARBOR",
            WATARU: "WATARU",
            GOU: "GOU",
            MISAKI: "MISAKI",
            SHADOW: "SHADOW"
        };

        // Scenario Data
        const SCENARIO = {
            start: {
                id: 'start',
                name: 'Ê∏â',
                text: '„Äå„ÅÇ„Éº„ÄÅÊöë„ÅÑ‚Ä¶„ÄÇ‰ªäÊó•„ÅÆÁ∑¥Áøí„ÄÅ„ÇÇ„ÅÜÁµÇ„Çè„Çä„Åß„Çà„Åè„Å™„ÅÑ„ÅãÔºü Á£ØËæ∫„ÅÆÂ§è„ÅØ„ÄÅÊπøÂ∫¶„ÅåÊÆ∫‰∫∫ÁöÑ„Åô„Åé„Çã„Å†„Çç„ÄÇ„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'wataru',
                choices: [
                    { text: 'Ë±™„Å´ÂêåÊÑè„ÇíÊ±Ç„ÇÅ„Çã', nextScene: 'talk_gou' },
                    { text: 'Âè§„ÅÑÈÉ®Ë™å„ÇíË™≠„ÅøËÄΩ„Çã', nextScene: 'read_diary_deep' },
                    { text: 'Á™ì„ÅÆÂ§ñ„ÅÆÁï∞Â∏∏„Å™ÂÖâÊôØ„Å´Ê∞ó„Å•„Åè', nextScene: 'look_window' }
                ]
            },
            talk_gou: {
                id: 'talk_gou',
                name: 'Ë±™',
                text: '„ÄåÁîò„ÅÑ„ÅûÊ∏âÔºÅ„Åì„ÅÆÊöë„Åï„Åì„Åù„Åå„É®„ÉÉ„Éà‰πó„Çä„ÅÆÁ≠ãËÇâ„ÇíËÇ≤„Å¶„Çã„Çì„Å†ÔºÅ‚Ä¶„Å®Ë®Ä„ÅÑ„Åü„ÅÑ„Å®„Åì„Çç„Å†„Åå„ÄÅÂÆü„ÅØ‰ø∫„ÇÇÈôêÁïå„Å†„ÄÇ„Ç¢„Ç§„Çπ„ÄÅË≤∑„ÅÑ„Å´Ë°å„Åã„Å™„ÅÑ„ÅãÔºü„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'gou',
                choices: [
                    { text: 'Ë≥ºË≤∑ÈÉ®„Å∏Âêë„Åã„ÅÜ', nextScene: 'go_shop' },
                    { text: '„ÄåÈáéÁç£ÂÖàËº©„Äç„ÅÆÂôÇ„Å´„Å§„ÅÑ„Å¶ËÅû„Åè', nextScene: 'ask_legend' }
                ]
            },
            read_diary_deep: {
                id: 'read_diary_deep',
                name: 'Ê∏â',
                text: '20Âπ¥Ââç„ÅÆÈÉ®Ë™å„Å´ÁõÆ„ÅåÊ≠¢„Åæ„Çã„ÄÇ„Äé‚Ä¶Êµ∑„ÅåÂâ≤„Çå„ÄÅ„Åù„Åì„Åã„Çâ‰∏Ä‰∫∫„ÅÆÁî∑„ÅåÁèæ„Çå„Åü„ÄÇÂΩº„ÅØÊûï„ÇíÊä±„Åà„ÄÅÂíÜÂìÆ„Åó„Åü„ÄÇ114514„ÄÅ„Å®„ÄÇ„Äè‚Ä¶„Åì„Çå„ÄÅÊú¨ÂΩì„Å´„É®„ÉÉ„ÉàÈÉ®„ÅÆË®òÈå≤„ÅãÔºü',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'none',
                choices: [
                    { text: '„Åï„Çâ„Å´Ââç„ÅÆ„Éö„Éº„Ç∏„Çí„ÇÅ„Åè„Çã', nextScene: 'diary_past' },
                    { text: '‰∏çÊ∞óÂë≥„Å™„ÅÆ„ÅßÊú¨„ÇíÈñâ„Åò„Çã', nextScene: 'start' }
                ]
            },
            look_window: {
                id: 'look_window',
                name: 'Ê∏â',
                text: '„É®„ÉÉ„Éà„Éè„Éº„Éê„Éº„ÅÆÂêë„Åì„ÅÜ„Å´„ÄÅÈªÑÈáë„Å´Ëºù„Åè‰∫∫ÂΩ±„ÅåË¶ã„Åà„ÅüÊ∞ó„Åå„Åó„Åü„ÄÇ„ÅÑ„ÇÑ„ÄÅ„Åü„Å†„ÅÆÈôΩÁÇé„Åã‚Ä¶Ôºü',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'none',
                choices: [
                    { text: 'Â≤¨ÂÖàÁîü„Å´Â†±Âëä„Åô„Çã', nextScene: 'check_teacher' },
                    { text: 'ÂèåÁúºÈè°„Åß„Ç∫„Éº„É†„Åô„Çã', nextScene: 'zoom_shadow' }
                ]
            },
            zoom_shadow: {
                id: 'zoom_shadow',
                name: 'Ê∏â',
                text: 'ÂèåÁúºÈè°„ÅÆ„É¨„É≥„Ç∫Ë∂ä„Åó„Å´„ÄÅÁî∑„Å®ÁõÆ„ÅåÂêà„Å£„ÅüÊ∞ó„Åå„Åó„Åü„ÄÇÁî∑„ÅØË¶™Êåá„ÇíÁ´ã„Å¶„ÄÅ„Äå„Éä„Ç§„Çπ„Ç•ÔºÅ„Äç„Å®Âè´„Çì„Å†Ôºà„Çà„ÅÜ„Å™Ê∞ó„Åå„Åó„ÅüÔºâ„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'shadow',
                choices: [
                    { text: 'Ëá™ÂàÜ„ÅÆÁõÆ„ÇíÁñë„ÅÜ', nextScene: 'start' },
                    { text: 'È≠Ç„ÅåÈúá„Åà„Çã„ÅÆ„ÇíÊÑü„Åò„Çã', nextScene: 'ending_gag' }
                ]
            },
            go_shop: {
                id: 'go_shop',
                name: 'Ë±™',
                text: '„Äå„Åä„Å∞„Å°„ÇÉ„Çì„ÄÅ„Ç¨„É™„Ç¨„É™Âêõ‰∏Ä„Å§ÔºÅ‚Ä¶„ÇìÔºü„Å™„Çì„Å†„Åì„ÅÆ„Äé„Éõ„É¢„Éª„Çµ„Éî„Ç®„É≥„ÇπÂë≥„Äè„Å£„Å¶„ÅÑ„ÅÜÊñ∞‰Ωú„ÅØ‚Ä¶Ôºü„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'gou',
                choices: [
                    { text: 'Êñ∞‰Ωú„ÇíË≤∑„Å£„Å¶„Åø„Çã', nextScene: 'eat_ice' },
                    { text: 'ÊôÆÈÄö„ÅÆ„ÇΩ„Éº„ÉÄÂë≥„Å´„Åô„Çã', nextScene: 'normal_ice' }
                ]
            },
            eat_ice: {
                id: 'eat_ice',
                name: 'Ê∏â',
                text: '‰∏ÄÂè£È£ü„Åπ„ÅüÁû¨Èñì„ÄÅËÑ≥ÂÜÖ„Å´ÈáéÂ§™„ÅÑÂ£∞„ÅåÈüø„ÅçÊ∏°„Å£„Åü„ÄÇ„Äå‚Ä¶ÈÄù„Åç„Çπ„ÇÆ„Ç£ÔºÅ„ÄçÊÑèË≠ò„ÅåÈÅ†„ÅÆ„ÅÑ„Å¶„ÅÑ„Åè‚Ä¶„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'none',
                choices: [{ text: 'Â§©„Çí‰ª∞„Åê', nextScene: 'ending_gag' }]
            },
            normal_ice: {
                id: 'normal_ice',
                name: 'Ë±™',
                text: '„ÄåËêΩ„Å°ÁùÄ„Åè„Å™„ÅÇ‚Ä¶„ÄÇ„ÇÑ„Å£„Å±„ÇäÂ§è„ÅØ„Åì„Çå„Å†„Çà„ÄÇ‚Ä¶„Å®„Åì„Çç„ÅßÊ∏â„ÄÅ„ÅÇ„Åù„Åì„Å´ËêΩ„Å°„Å¶„ÇãËå∂Ëâ≤„ÅÆÊûï„ÄÅ„ÅäÂâç„ÅÆ„Åò„ÇÉ„Å™„ÅÑ„Çà„Å™Ôºü„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'gou',
                choices: [
                    { text: 'Êûï„ÇíÊãæ„ÅÑ‰∏ä„Åí„Çã', nextScene: 'pick_pillow' },
                    { text: 'ÁÑ°Ë¶ñ„Åó„Å¶Á∑¥Áøí„Å´Êàª„Çã', nextScene: 'back_practice' }
                ]
            },
            pick_pillow: {
                id: 'pick_pillow',
                name: 'Ê∏â',
                text: 'Êûï„Å´Ëß¶„Çå„ÅüÁû¨Èñì„ÄÅÁåõÁÉà„Å™Áù°È≠î„Å´Ë•≤„Çè„Çå„Åü„ÄÇ„Åì„ÅÆÊüî„Çâ„Åã„Åï„ÄÅ„Åì„ÅÆÁç£„ÅÆ„Çà„ÅÜ„Å™ÂåÇ„ÅÑ‚Ä¶Êäó„Åà„Å™„ÅÑ‚Ä¶„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'none',
                choices: [{ text: 'Ê∑±„ÅÑÁú†„Çä„Å´ËêΩ„Å°„Çã', nextScene: 'ending_comedy_homework' }]
            },
            ask_legend: {
                id: 'ask_legend',
                name: 'Ë±™',
                text: '„Äå„ÅÇ„ÅÇ„ÄÅ„ÅÇ„ÅÆÂôÇ„Åã„ÄÇÊ§úË¶ãÂ∑ù„ÅÆÊµú„Å´„ÄÅÂ§ú„Å™Â§ú„Å™„ÄéÊ±ö„ÅÑÂè´„Å≥Â£∞„Äè„Çí‰∏ä„Åí„Å™„Åå„Çâ„É®„ÉÉ„Éà„ÇíÊºï„ÅêÊÄ™‰∫∫„ÅåÂá∫„Çã„Å£„Å¶„ÇÑ„Å§„Å†„Çç„ÄÇÂÆü„ÅØ„ÄÅ‰ø∫„ÅÆÂÖÑË≤¥„Åå‚Ä¶„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'gou',
                choices: [
                    { text: 'ÂÖÑË≤¥„ÅÆË©±„ÇíË©≥„Åó„ÅèËÅû„Åè', nextScene: 'brother_story' },
                    { text: '„Åù„ÅÆÊÄ™‰∫∫„ÇíÊé¢„Åó„Å´Ë°å„Åì„ÅÜ„Å®ÊèêÊ°à„Åô„Çã', nextScene: 'hunt_beast' }
                ]
            },
            brother_story: {
                id: 'brother_story',
                name: 'Ë±™',
                text: '„ÄåÂÖÑË≤¥„ÅåÂ§úÈá£„Çä„Çí„Åó„Å¶„ÅÑ„Åü„Çâ„ÄÅÊµ∑Èù¢„ÇíÊªëËµ∞„Åô„ÇãÁî∑„Åå„Äé„ÅÇ„ÄÅ„ÅäÁñ≤„Çå„Å£„Åó„Åü„ÉºÔºÅ„Äè„Å®Êå®Êã∂„Åó„Å¶„Åç„Åü„Çâ„Åó„ÅÑ„ÄÇÁ§ºÂÑÄÊ≠£„Åó„ÅÑÊÄ™‰∫∫„Å†„Çà„Å™„ÄÇ„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'gou',
                choices: [
                    { text: '„Åù„Çå„ÅØ„Åü„Å†„ÅÆÂ≤¨ÂÖàÁîü„Åò„ÇÉ„Å™„ÅÑ„ÅãÔºü', nextScene: 'attack_sound' },
                    { text: 'ÊÄ™‰∫∫„ÅÆÊ≠£‰Ωì„ÇíÁ™Å„ÅçÊ≠¢„ÇÅ„Åü„ÅÑ', nextScene: 'hunt_beast' }
                ]
            },
            hunt_beast: {
                id: 'hunt_beast',
                name: 'Ê∏â',
                text: '‰ø∫„Åü„Å°„ÅØÂ§ú„ÅÆ„Éè„Éº„Éê„Éº„Å´Âøç„Å≥Ëæº„Çì„Å†„ÄÇÊöóÈóá„ÅÆ‰∏≠„ÄÅÁ¢∫„Åã„Å´„ÅÇ„ÅÆÈü≥„ÅåËÅû„Åì„Åà„Çã„ÄÇ„Äå„É§„ÉÉ‚Ä¶„É§„ÉÉ‚Ä¶ÔºÅ„Äç',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'none',
                choices: [
                    { text: 'Èü≥„ÅÆÊñπÂêë„Å∏Á™ÅÊíÉ„Åô„Çã', nextScene: 'attack_sound' },
                    { text: 'ÊÖéÈáç„Å´ÊßòÂ≠ê„Çí‰º∫„ÅÜ', nextScene: 'watch_shadow' }
                ]
            },
            watch_shadow: {
                id: 'watch_shadow',
                name: 'Ê∏â',
                text: 'ÁõÆ„ÇíÂáù„Çâ„Åô„Å®„ÄÅ„Åù„Åì„Å´„ÅØ‰∏ÄÂøÉ‰∏ç‰π±„Å´ËÖπÁ≠ã„ÇíÈçõ„Åà„ÇãÂ≤¨ÂÖàÁîü„ÅÆÂßø„Åå„ÄÇ„Äå‚Ä¶„Çà„Åó„ÄÅ114514ÂõûÈÅîÊàê„Å†„ÄÇ„ÅÑ„ÅÑ„Çà„ÄÅÊù•„ÅÑ„Çà„ÄÅÂ§è‰ºë„Åø‚Ä¶ÔºÅ„Äç',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'misaki',
                choices: [{ text: '„Åù„Å£„Å®„Åó„Å¶„Åä„Åè', nextScene: 'ending_comedy_homework' }]
            },
            attack_sound: {
                id: 'attack_sound',
                name: 'Â≤¨ÂÖàÁîü',
                text: '„Äå„Åì„ÇâÔºÅÂ§ú‰∏≠„Å´‰Ωï„Çí„Åó„Å®„ÇãÔºÅ‚Ä¶„ÅÇ„ÄÅÊ∏â„Åã„ÄÇ„Å°„Çá„ÅÜ„Å©„ÅÑ„ÅÑ„ÄÅ„Åì„ÅÆ„Ç≠„É•„Ç¶„É™„ÇíÈÅã„Å∂„ÅÆ„ÇíÊâã‰ºù„Åà„ÄÇ„Äç',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'misaki',
                choices: [{ text: 'Êâã‰ºù„ÅÜ', nextScene: 'ending_comedy_pepper' }]
            },
            check_teacher: {
                id: 'check_teacher',
                name: 'Â≤¨ÂÖàÁîü',
                text: '„Äå‚Ä¶Ë¶ã„Åü„Åã„ÄÇ„ÅÇ„Çå„Åå„ÄéÊ≤à„Åæ„Å¨Áî∑„Äè„ÅÆÂπªÂΩ±„Å†„ÄÇÁ£ØËæ∫„É®„ÉÉ„ÉàÈÉ®„Å´ÂÖ•ÈÉ®„Åó„ÅüËÄÖ„ÅØ„ÄÅÁöÜ‰∏ÄÂ∫¶„ÅØ„ÅÇ„Çå„Å´È≠Ö‰∫Ü„Åï„Çå„Çã„ÄÇ„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'misaki',
                choices: [
                    { text: 'ÂÖàÁîü„ÇÇË¶ã„Åü„Åì„Å®„Åå„ÅÇ„Çã„ÅÆ„ÅãËÅû„Åè', nextScene: 'teacher_past' },
                    { text: '„ÄåÊ≤à„Åæ„Å¨Áî∑„Äç„ÅÆÊ≠£‰Ωì„ÅØÔºü', nextScene: 'what_is_man' }
                ]
            },
            what_is_man: {
                id: 'what_is_man',
                name: 'Â≤¨ÂÖàÁîü',
                text: '„Äå„Åù„Çå„ÅØ„ÄÅÂ§è„ÅÆÂÖ∑ÁèæÂåñ„Å†„ÄÇË™∞„ÇÇ„ÅåÂøÉ„ÅÆ‰∏≠„Å´È£º„Å£„Å¶„ÅÑ„Çã„ÄÅÂ•îÊîæ„ÅßÂäõÂº∑„ÅÑ„ÄÅ„Åù„Çå„Åß„ÅÑ„Å¶Â∞ë„Åó‰∏çÊΩî„Å™Ê¨≤Êúõ„ÅÆË±°Âæ¥„Å†„Çà„ÄÇ„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'misaki',
                choices: [
                    { text: 'Ê∑±„ÅÑË©±„Å†‚Ä¶', nextScene: 'ending_surreal' },
                    { text: 'ÈÅ©ÂΩì„Å™„Åì„Å®„ÇíË®Ä„Å£„Å¶„Åæ„Åõ„Çì„ÅãÔºü', nextScene: 'start' }
                ]
            },
            teacher_past: {
                id: 'teacher_past',
                name: 'Â≤¨ÂÖàÁîü',
                text: 'ÂÖàÁîü„ÅØÈÅ†„ÅÑÁõÆ„Çí„Åó„Åü„ÄÇ„ÄåÁßÅ„ÅÆÁèæÂΩπÊôÇ‰ª£„ÄÅÈÉ®ÂÆ§„ÅÆ„É≠„ÉÉ„Ç´„Éº„Å´„ÅØÂ∏∏„Å´„Äé„ÅäËå∂„Äè„Å®„ÄéÊûï„Äè„Åå‰æõ„Åà„Çâ„Çå„Å¶„ÅÑ„Åü„ÇÇ„ÅÆ„Å†„ÄÇ„Åù„Çå„ÅåÂãùÂà©„Å∏„ÅÆÂÑÄÂºè„Å†„Å£„Åü„ÄÇ„Äç',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'misaki',
                choices: [
                    { text: '„É≠„ÉÉ„Ç´„Éº„ÇíÈñã„Åë„Å¶„Åø„Çã', nextScene: 'open_locker' },
                    { text: '‰ªä„ÅÆÁ∑¥Áøí„Å®Èñ¢‰øÇ„Å™„ÅÑ„ÄÅ„Å®Âàá„ÇäÊç®„Å¶„Çã', nextScene: 'ignore_teacher' }
                ]
            },
            ignore_teacher: {
                id: 'ignore_teacher',
                name: 'Ë±™',
                text: '„Äå„Åä„ÅÑÊ∏â„ÄÅÂÖàÁîü„ÅÆË©±„ÇíÁÑ°Ë¶ñ„Åó„Å¶Êµ∑„Å´Ë°å„Åì„ÅÜ„ÅúÔºÅ‰ªäÊó•„ÅØÈ¢®„Åå„ÅÑ„ÅÑÔºÅ„ÄçË±™„ÅåÂº∑Âºï„Å´‰ø∫„ÇíÈÄ£„ÇåÂá∫„Åó„Åü„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'gou',
                choices: [{ text: 'Êµ∑„Å∏', nextScene: 'back_practice' }]
            },
            open_locker: {
                id: 'open_locker',
                name: 'Ê∏â',
                text: '„ÇÆ„Ç£„Ç£‚Ä¶„Å®Èü≥„ÇíÁ´ã„Å¶„Å¶Èñã„ÅÑ„Åü„É≠„ÉÉ„Ç´„Éº„ÅÆ‰∏≠„Å´„ÅØ„ÄÅËâ≤Ë§™„Åõ„ÅüÊ∞¥Ê≥≥„Éë„É≥„ÉÑ„ÅåÁ•Ä„Çâ„Çå„Å¶„ÅÑ„Åü„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'none',
                choices: [{ text: 'Êâã„ÇíÂêà„Çè„Åõ„Çã', nextScene: 'ending_romance' }]
            },
            diary_past: {
                id: 'diary_past',
                name: 'Ê∏â',
                text: '„Éö„Éº„Ç∏„Çí„ÇÅ„Åè„Çã„Å®„ÄÅÊñáÂ≠ó„ÅåÊ∏¶„ÇíÂ∑ª„ÅÑ„Å¶Âãï„ÅçÂá∫„Åó„ÅüÔºÅ„Äå„ÅÑ„ÅÑ„Çà„ÄÅÊù•„ÅÑ„Çà‚Ä¶„Äç„Å®„ÅÑ„ÅÜÂõÅ„Åç„ÅåËÅû„Åì„Åà„Çã„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'none',
                choices: [
                    { text: 'Êú¨„ÅÆ‰∏≠„Å´Âê∏„ÅÑËæº„Åæ„Çå„Çã', nextScene: 'sucked_in' },
                    { text: 'ÂäõÊäÄ„ÅßÊú¨„ÇíÈñâ„Åò„Çã', nextScene: 'close_book_force' }
                ]
            },
            close_book_force: {
                id: 'close_book_force',
                name: 'Ê∏â',
                text: '„Äå„ÅÜ„Åä„Åâ„ÅâÔºÅ„ÄçÊ∏æË∫´„ÅÆÂäõ„ÅßÊú¨„ÇíÈñâ„Åò„Çã„ÄÇÂøÉËáì„Åå„Éê„ÇØ„Éê„ÇØË®Ä„Å£„Å¶„ÅÑ„Çã„ÄÇ‚Ä¶Âç±„Å™„Åã„Å£„Åü„ÄÅ‰ªä‰Ωï„Åã„ÇíË¶ã„Åü„ÇâÊàª„Çå„Å™„Åè„Å™„Å£„Å¶„ÅÑ„ÅüÊ∞ó„Åå„Åô„Çã„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'wataru',
                choices: [{ text: 'ËêΩ„Å°ÁùÄ„Åè', nextScene: 'start' }]
            },
            sucked_in: {
                id: 'sucked_in',
                text: 'Ê∞ó„Å•„Åë„Å∞„Åù„Åì„ÅØ„ÄÅÈáçÂäõ„Åå‰∏ä‰∏ãÈÄÜ„Åï„Åæ„Å´„Å™„Å£„ÅüÁ®≤ÊØõ„É®„ÉÉ„Éà„Éè„Éº„Éê„Éº„Å†„Å£„Åü„ÄÇÁ©∫„Å´„ÅØÂ∑®Â§ß„Å™È°î„ÅåÊµÆ„ÅÑ„Å¶„ÅÑ„Çã„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'none',
                choices: [{ text: 'ÈÅãÂëΩ„ÇíÂèó„ÅëÂÖ•„Çå„Çã', nextScene: 'ending_sf' }]
            },
            back_practice: {
                id: 'back_practice',
                name: 'Ë±™',
                text: '„Äå„Çà„Åó„ÄÅ„Åò„ÇÉ„ÅÇ‰ªäÊó•„ÅØÊ≤àËÑ±ÔºàÊ≤àÊ≤°„Åó„Åü„É®„ÉÉ„Éà„ÇíÁ´ã„Å¶Áõ¥„ÅôÁ∑¥ÁøíÔºâ„ÅÆÂçÉÊú¨„Éé„ÉÉ„ÇØ„Å†ÔºÅË°å„Åè„ÅûÊ∏âÔºÅ„Äç',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'gou',
                choices: [
                    { text: 'ÈôêÁïå„Åæ„ÅßËÄê„Åà„Çã', nextScene: 'practice_limit' },
                    { text: '„Çè„Åñ„Å®Ê≤àÊ≤°„Åó„Åü„Åæ„Åæ„Å´„Åô„Çã', nextScene: 'stay_under' }
                ]
            },
            practice_limit: {
                id: 'practice_limit',
                text: 'Â§ïÊöÆ„ÇåÊôÇ„ÄÅ‰ø∫„Åü„Å°„ÅÆÂâç„Å´„ÅØÁúü„Å£Ëµ§„Å´Êüì„Åæ„Å£„ÅüÊµ∑„Å®„ÄÅÊ∏Ö„ÄÖ„Åó„ÅÑÁñ≤Âä¥ÊÑü„Å†„Åë„ÅåÊÆã„Å£„Åü„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'wataru',
                choices: [{ text: 'ÊòéÊó•„ÇÇÈ†ëÂºµ„Çç„ÅÜ', nextScene: 'ending_true' }]
            },
            stay_under: {
                id: 'stay_under',
                text: 'Êµ∑‰∏≠„Åß„ÄÅ‰ø∫„ÅØÈ≠ö„Å´„Å™„Å£„Åü„ÄÇ„ÅÑ„ÇÑ„ÄÅÈ≠ö„Å®‰∫∫Èñì„ÅÆ„Éè„Ç§„Éñ„É™„ÉÉ„Éâ„ÄÅ„Äå„Éû„Éº„Éû„É≥„Äç„Å´ÈÄ≤Âåñ„Åó„Åü„ÅÆ„Å†„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'none',
                choices: [{ text: 'Ê∑±Êµ∑„Å∏', nextScene: 'ending_surreal' }]
            },
            // Endings
            ending_true: {
                id: 'ending_true',
                text: '‰ø∫„Åü„Å°„ÅØ„Å§„ÅÑ„Å´Ëæø„ÇäÁùÄ„ÅÑ„Åü„ÄÇÁúü„ÅÆÂèãÊÉÖ„ÄÅÁúü„ÅÆÂ§è„ÄÇ„Åù„Åì„Å´„ÅØÈáéÁç£„ÇÇ‰∏ÄÊ¥æ„ÇÇ„Å™„Åè„ÄÅ„Åü„Å†È¢®„Å®Ê≥¢„ÇíÊ•Ω„Åó„ÇÄÂ∞ëÂπ¥„Åü„Å°„Åå„ÅÑ„Åü„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'wataru',
                isEnding: true,
                name: 'Ending: ËÅñ„Å™„ÇãÂ§è‰ºë„Åø'
            },
            ending_comedy_pepper: {
                id: 'ending_comedy_pepper',
                text: 'ÁµêÂ±Ä„ÄÅÈáéÁç£ÂÖàËº©„Åß„ÅØ„Å™„Åè„Äå„Éî„Éº„Éû„É≥ÂÖàËº©„Äç„ÅÆÂΩ±„ÇíËøΩ„Å£„Å¶„ÅÑ„Åü„Å†„Åë„Å†„Å£„Åü„ÄÇÂ≤¨ÂÖàÁîü„ÅÆ„Ç≠„É•„Ç¶„É™Ëæ≤Â†¥„ÅØ‰ªäÊó•„ÇÇÂπ≥Âíå„Å†„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'misaki',
                isEnding: true,
                name: 'Ending: „Éî„Éº„Éû„É≥„ÅØË¶ã„Åü'
            },
            ending_comedy_homework: {
                id: 'ending_comedy_homework',
                text: 'Â≤¨ÂÖàÁîü„Å´„Åì„Å£„Å¥„Å©„ÅèÂè±„Çâ„Çå„ÅüÂæå„ÄÅÂ±ÖÊÆã„Çä„ÅßÂ§è‰ºë„Åø„ÅÆÂÆøÈ°å„Çí„Åï„Åõ„Çâ„Çå„Çã„Åì„Å®„Å´„Å™„Å£„Åü„ÄÇ„Åì„Çå„ÇÇ„Åæ„ÅüÈùíÊò•„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'gou',
                isEnding: true,
                name: 'Ending: Â∏∞„Å£„Å¶„Åç„ÅüÁî∑„Åü„Å°'
            },
            ending_sf: {
                id: 'ending_sf',
                text: 'Áï∞Ê¨°ÂÖÉ„ÅÆ„Éè„Éº„Éê„Éº„Åß„ÄÅ‰ø∫„Åü„Å°„ÅØÈäÄÊ≤≥Á≥ª„ÅÆ„É®„ÉÉ„Éà„É¨„Éº„Çπ„Å´ÂèÇÂä†„Åô„Çã„Åì„Å®„Å´„Å™„Å£„Åü„ÄÇÊïµ„ÅØÂº∑Â§ß„Å†„Åå„ÄÅ114514„ÅÆÂä†Ë≠∑„Åå„ÅÇ„Çã„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'none',
                isEnding: true,
                name: 'Ending: Áï∞Ê¨°ÂÖÉ„ÅÆÊµ∑'
            },
            ending_romance: {
                id: 'ending_romance',
                text: 'Â≤¨ÂÖàÁîü„ÅÆÈÅéÂéª„ÇíÁü•„Å£„Åü‰ø∫„Åü„Å°„ÅØ„ÄÅÈÉ®ÂÆ§„ÇíËÅñÂú∞„Å®„Åó„Å¶ÂÆà„ÇäÊäú„Åè„Åì„Å®„ÇíË™ì„Å£„Åü„ÄÇ„Éõ„É¢„ÇΩ„Éº„Ç∑„É£„É´„Å™ÁµÜ„ÅØÊ∞∏ÈÅ†„Å†„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'misaki',
                isEnding: true,
                name: 'Ending: ÈÉ®ÂÆ§„ÅÆÂØÜÂÆ§'
            },
            ending_gag: {
                id: 'ending_gag',
                text: '„Ç¢„Ç§„Çπ„ÅÆÂäõ„ÅßË∂Ö„Çµ„Ç§„É§‰∫∫„Å™„Çâ„Å¨„ÄåË∂ÖÈáéÁç£‰∫∫„Äç„Å´Ë¶öÈÜí„ÄÇÁ£ØËæ∫È´òÊ†°„ÅÆÊï∑Âú∞„Åî„Å®ÊàêÂ±§Âúè„Åæ„ÅßÈ£õ„Çì„Åß„ÅÑ„Å£„Å¶„Åó„Åæ„Å£„Åü„ÄÇ',
                background: IMAGE_PROMPTS.CLUB_ROOM,
                character: 'wataru',
                isEnding: true,
                name: 'Ending: ‰ºùË™¨„ÅÆÂßã„Åæ„Çä'
            },
            ending_surreal: {
                id: 'ending_surreal',
                text: '‰ø∫„ÅØÁ£ØËæ∫„ÅÆÊµ∑„Å®‰∏Ä‰ΩìÂåñ„Åó„Åü„ÄÇ„Åü„Åæ„Å´„É®„ÉÉ„Éà„Çí„Å≤„Å£„Åè„ÇäËøî„Åô„ÅÆ„ÅØ„ÄÅ‰ø∫„ÅÆ„Å°„Çá„Å£„Å®„Åó„ÅüÊÇ™ÊàØ„Å†„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'none',
                isEnding: true,
                name: 'Ending: Á£ØËæ∫„ÅÆÈ¢®„ÄÅ„Åü„Å†„ÅÆÈ¢®'
            },
            // ÁâπÂà•„Ç®„É≥„Éá„Ç£„É≥„Ç∞ÔºàÂÖ®„Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÇØ„É™„Ç¢Âæå„ÅÆ„ÅøË°®Á§∫Ôºâ
            ending_true_final: {
                id: 'ending_true_final',
                text: 'ÂÖ®„Å¶„ÅÆ„Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÇíË¶ãÂ±ä„Åë„ÅüÂêõ„Å∏„ÄÇÁ£ØËæ∫„ÅÆÊµ∑„ÅØ„ÄÅÂêõ„ÅÆÂãáÊ∞ó„ÇíÁß∞„Åà„Çã„ÄÇ„Åù„Åó„Å¶„ÄÅÂΩº„ÅåÁèæ„Çå„Åü„ÄÇ',
                background: IMAGE_PROMPTS.HARBOR,
                character: 'shadow',
                isEnding: true,
                isTrueFinal: true,
                name: 'TRUE ENDING: ÈáéÁç£ÂÖàËº©„ÄÅÈôçËá®'
            }
        };

        // Main App Component
        const App = () => {
            // BGMÁÆ°ÁêÜ
            const bgmRef = useRef(null);
            const [isBgmPlaying, setIsBgmPlaying] = useState(false);
            const [bgmEnabled, setBgmEnabled] = useState(() => {
                const saved = localStorage.getItem('bgm_enabled');
                return saved === null ? true : saved === 'true';
            });

            // Load persistent data
            const [clearedEndings, setClearedEndings] = useState(() => {
                const saved = localStorage.getItem('cleared_endings');
                return saved ? JSON.parse(saved) : [];
            });
            
            const [allVisitedScenes, setAllVisitedScenes] = useState(() => {
                const saved = localStorage.getItem('visited_scenes');
                return saved ? JSON.parse(saved) : ['start'];
            });

            const [gameState, setGameState] = useState({
                currentSceneId: 'start',
                history: [],
                visitedScenes: ['start']
            });

            const [bgImage, setBgImage] = useState(getStaticImage('CLUB_ROOM'));
            const [charImage, setCharImage] = useState(null);
            const [isTyping, setIsTyping] = useState(false);
            const [displayedText, setDisplayedText] = useState('');
            const [isLogOpen, setIsLogOpen] = useState(false);
            const [isGalleryOpen, setIsGalleryOpen] = useState(false);
            const [showTrueFinal, setShowTrueFinal] = useState(false);

            // BGMÂà∂Âæ°
            useEffect(() => {
                if (bgmRef.current) {
                    bgmRef.current.volume = 0.3;
                    bgmRef.current.loop = true;
                }
            }, []);

            const toggleBgm = () => {
                const newState = !bgmEnabled;
                setBgmEnabled(newState);
                localStorage.setItem('bgm_enabled', newState);
                
                if (newState && bgmRef.current) {
                    bgmRef.current.play().catch(e => console.log('BGM play failed:', e));
                    setIsBgmPlaying(true);
                } else if (bgmRef.current) {
                    bgmRef.current.pause();
                    setIsBgmPlaying(false);
                }
            };

            // ÂàùÂõû„ÇØ„É™„ÉÉ„ÇØ„ÅßBGMÈñãÂßã
            useEffect(() => {
                const startBgm = () => {
                    if (bgmEnabled && bgmRef.current && !isBgmPlaying) {
                        bgmRef.current.play().catch(e => console.log('BGM play failed:', e));
                        setIsBgmPlaying(true);
                    }
                };
                document.addEventListener('click', startBgm, { once: true });
                return () => document.removeEventListener('click', startBgm);
            }, [bgmEnabled, isBgmPlaying]);

            // ÂÖ®„Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÇØ„É™„Ç¢„ÉÅ„Çß„ÉÉ„ÇØ
            useEffect(() => {
                const normalEndings = Object.values(SCENARIO).filter(s => s.isEnding && !s.isTrueFinal);
                if (clearedEndings.length === normalEndings.length && normalEndings.length === 7) {
                    setShowTrueFinal(true);
                }
            }, [clearedEndings]);

            // Safe scene retrieval
            const currentScene = SCENARIO[gameState.currentSceneId] || SCENARIO['start'];

            const updateImages = useCallback((scene) => {
                if (scene.background.includes("CLUB_ROOM")) setBgImage(getStaticImage('CLUB_ROOM'));
                if (scene.background.includes("HARBOR")) setBgImage(getStaticImage('HARBOR'));

                if (scene.character !== 'none') {
                    let charKey = '';
                    switch (scene.character) {
                        case 'wataru': charKey = 'WATARU'; break;
                        case 'gou': charKey = 'GOU'; break;
                        case 'misaki': charKey = 'MISAKI'; break;
                        case 'shadow': charKey = 'SHADOW'; break;
                    }
                    if (charKey) setCharImage(getStaticImage(charKey));
                } else {
                    setCharImage(null);
                }
            }, []);

            const typeText = useCallback((text) => {
                setIsTyping(true);
                setDisplayedText('');
                let i = 0;
                const interval = setInterval(() => {
                    if (i < text.length) {
                        setDisplayedText((prev) => prev + text.charAt(i));
                        i++;
                    }
                    if (i >= text.length) {
                        clearInterval(interval);
                        setIsTyping(false);
                    }
                }, 25);
            }, []);

            useEffect(() => {
                updateImages(currentScene);
                typeText(currentScene.text);

                // Track visited scenes globally
                if (!allVisitedScenes.includes(currentScene.id)) {
                    const newVisited = [...allVisitedScenes, currentScene.id];
                    setAllVisitedScenes(newVisited);
                    localStorage.setItem('visited_scenes', JSON.stringify(newVisited));
                }

                // Save ending if reached
                if (currentScene.isEnding && currentScene.name) {
                    if (!clearedEndings.includes(currentScene.name)) {
                        const newEndings = [...clearedEndings, currentScene.name];
                        setClearedEndings(newEndings);
                        localStorage.setItem('cleared_endings', JSON.stringify(newEndings));
                    }
                }
            }, [gameState.currentSceneId, updateImages, typeText]);

            const handleChoice = (nextId) => {
                if (isTyping) {
                    setDisplayedText(currentScene.text);
                    setIsTyping(false);
                    return;
                }
                // Prevent transition to non-existent scenes
                if (!SCENARIO[nextId]) {
                    console.warn(`Target scene ${nextId} not found, resetting to start.`);
                    setGameState((prev) => ({
                        ...prev,
                        currentSceneId: 'start',
                        history: [...prev.history, { name: currentScene.name, text: currentScene.text }]
                    }));
                    return;
                }
                setGameState((prev) => ({
                    ...prev,
                    currentSceneId: nextId,
                    history: [...prev.history, { name: currentScene.name, text: currentScene.text }]
                }));
            };

            const resetGame = () => {
                setGameState({
                    currentSceneId: 'start',
                    history: [],
                    visitedScenes: ['start']
                });
            };

            // ÁâπÂà•„Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÅÆÈü≥Â£∞ÂÜçÁîü
            const playFinalVoice = () => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('„Åò„ÇÉ„Åë„Çì„ÄÅÂ§úÈ£ü„Åπ„Å´Ë°å„Åç„Åæ„Åó„Çá„ÅÜ„Å≠');
                    utterance.lang = 'ja-JP';
                    utterance.rate = 0.9;
                    utterance.pitch = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            };

            // ÁâπÂà•„Ç®„É≥„Éá„Ç£„É≥„Ç∞Âà∞ÈÅîÊôÇ
            useEffect(() => {
                if (currentScene.isTrueFinal) {
                    setTimeout(() => {
                        playFinalVoice();
                    }, 2000);
                }
            }, [currentScene.isTrueFinal]);

            return (
                <div className="relative w-screen h-screen overflow-hidden bg-black text-white select-none">
                    {/* BGM Audio Element */}
                    <audio ref={bgmRef} src={BGM_URLS.MAIN} />

                    {/* Background */}
                    <div 
                        className="absolute inset-0 bg-cover bg-center transition-all duration-1000"
                        style={{ backgroundImage: `url(${bgImage})` }}
                    >
                        <div className="absolute inset-0 bg-black/50" />
                    </div>

                    {/* Character */}
                    {charImage && (
                        <div className="absolute inset-0 flex items-end justify-center pointer-events-none">
                            <img 
                                src={charImage} 
                                className="h-[80vh] object-contain opacity-20 filter grayscale blur-sm"
                                alt="Character Shadow"
                            />
                        </div>
                    )}

                    {/* Header Controls */}
                    <div className="absolute top-0 left-0 right-0 p-4 flex justify-between items-start z-30">
                        <div className="bg-black/60 backdrop-blur-md p-4 border-l-4 border-yellow-400 max-w-xs md:max-w-md">
                            <h1 className="text-lg md:text-xl font-bold tracking-tighter pixel-font">Á£ØËæ∫„ÅÆÊµ∑„ÅØ„ÄÅ„Éõ„É¢„ÇΩ„Éº„Ç∑„É£„É´„Å™È¶ô„Çä„Åå„Åô„Çã„ÄÇ</h1>
                            <div className="flex gap-2 mt-2">
                                <button onClick={() => setIsLogOpen(true)} className="px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-xs border border-white/20 transition-all">LOG</button>
                                <button onClick={() => setIsGalleryOpen(true)} className="px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-xs border border-white/20 transition-all">GALLERY ({clearedEndings.length}/7)</button>
                                <button onClick={toggleBgm} className={`px-3 py-1 rounded text-xs border border-white/20 transition-all ${bgmEnabled ? 'bg-yellow-500/30 hover:bg-yellow-500/40' : 'bg-white/10 hover:bg-white/20'}`}>
                                    üéµ {bgmEnabled ? 'ON' : 'OFF'}
                                </button>
                            </div>
                        </div>
                        
                        {currentScene.isEnding && (
                            <div className="bg-red-600 px-6 py-2 rotate-3 transform shadow-2xl animate-bounce">
                                <span className="font-black text-xl italic">{currentScene.name}</span>
                            </div>
                        )}
                    </div>

                    {/* Bottom Interface */}
                    <div className="absolute bottom-0 left-0 right-0 p-4 md:p-8 flex flex-col gap-6 z-20">
                        
                        {/* Choices */}
                        {!isTyping && currentScene.choices && (
                            <div className="flex flex-col md:flex-row justify-center items-center gap-4 animate-slide-up">
                                {currentScene.choices.map((choice, idx) => {
                                    const hasVisited = allVisitedScenes.includes(choice.nextScene);
                                    return (
                                        <button
                                            key={idx}
                                            onClick={() => handleChoice(choice.nextScene)}
                                            className={`
                                                w-full md:w-auto min-w-[280px] px-8 py-4 backdrop-blur-lg border-2 rounded-xl text-lg font-bold transition-all transform hover:scale-105 active:scale-95 text-center shadow-xl group
                                                ${hasVisited 
                                                    ? 'bg-white/10 border-white/30 text-white hover:bg-white/20' 
                                                    : 'bg-yellow-500/20 border-yellow-400 text-yellow-200 hover:bg-yellow-500/40 shadow-[0_0_20px_rgba(234,179,8,0.3)]'}
                                            `}
                                        >
                                            <span className={hasVisited ? '' : 'animate-pulse'}>{choice.text}</span>
                                            {!hasVisited && <span className="block text-[10px] mt-1 text-yellow-400 opacity-60">NEW PATH</span>}
                                        </button>
                                    );
                                })}
                            </div>
                        )}

                        {/* Reset */}
                        {currentScene.isEnding && (
                            <div className="flex justify-center animate-slide-up flex-col gap-4 items-center">
                                {currentScene.isTrueFinal && (
                                    <div className="text-center mb-4 animate-pulse">
                                        <p className="text-4xl font-black text-yellow-400 mb-2">üéä TRUE ENDING üéä</p>
                                        <p className="text-xl text-yellow-200">ÈáéÁç£ÂÖàËº©„Äå„Åò„ÇÉ„Åë„Çì„ÄÅÂ§úÈ£ü„Åπ„Å´Ë°å„Åç„Åæ„Åó„Çá„ÅÜ„Å≠„Äç</p>
                                        <button 
                                            onClick={playFinalVoice}
                                            className="mt-4 px-6 py-3 bg-red-600 rounded-lg hover:bg-red-700 transition-all"
                                        >
                                            üîä „Çª„É™„Éï„ÇíÂÜçÁîü
                                        </button>
                                    </div>
                                )}
                                <button
                                    onClick={resetGame}
                                    className="px-10 py-5 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-full text-2xl font-black shadow-[0_0_30px_rgba(37,99,235,0.5)] hover:brightness-110 active:scale-95 transition-all"
                                >
                                    ÊúÄÂàù„Åã„Çâ„ÇÑ„ÇäÁõ¥„Åô
                                </button>
                            </div>
                        )}

                        {/* Textbox */}
                        <div className="relative w-full max-w-5xl mx-auto group">
                            {currentScene.name && (
                                <div className="absolute -top-7 left-6 px-6 py-2 bg-yellow-400 text-black font-black skew-x-12 shadow-lg z-10">
                                    <span className="-skew-x-12 block">{currentScene.name}</span>
                                </div>
                            )}
                            
                            <div 
                                className="w-full min-h-[160px] p-8 md:p-10 bg-black/80 backdrop-blur-2xl border-t-2 border-x-2 border-white/20 rounded-t-[2rem] shadow-2xl cursor-pointer hover:bg-black/90 transition-colors"
                                onClick={() => isTyping ? handleChoice(gameState.currentSceneId) : null}
                            >
                                <p className="text-xl md:text-2xl leading-relaxed tracking-wide font-medium">
                                    {displayedText}
                                    {isTyping && <span className="inline-block w-3 h-6 bg-white animate-pulse ml-1 align-middle" />}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Log Modal */}
                    {isLogOpen && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-xl z-[100] p-8 flex flex-col">
                            <div className="flex justify-between items-center mb-6 border-b border-white/20 pb-4">
                                <h2 className="text-3xl font-black pixel-font text-yellow-400">LOG (ÂõûÊÉ≥)</h2>
                                <button onClick={() => setIsLogOpen(false)} className="text-5xl font-light hover:text-red-500 transition-colors">&times;</button>
                            </div>
                            <div className="flex-1 overflow-y-auto space-y-6 pr-4">
                                {gameState.history.map((item, idx) => (
                                    <div key={idx} className="border-l-2 border-white/10 pl-6">
                                        <p className="text-yellow-400 font-bold mb-1">{item.name || '???'}</p>
                                        <p className="text-lg opacity-80">{item.text}</p>
                                    </div>
                                ))}
                                <div className="border-l-2 border-yellow-400 pl-6 bg-white/5 py-4">
                                    <p className="text-yellow-400 font-bold mb-1">{currentScene.name || '???'}</p>
                                    <p className="text-lg">{currentScene.text}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Gallery Modal */}
                    {isGalleryOpen && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-xl z-[100] p-8 flex flex-col">
                            <div className="flex justify-between items-center mb-6 border-b border-white/20 pb-4">
                                <h2 className="text-3xl font-black pixel-font text-blue-400">ENDING GALLERY</h2>
                                <button onClick={() => setIsGalleryOpen(false)} className="text-5xl font-light hover:text-red-500 transition-colors">&times;</button>
                            </div>
                            
                            {/* ÁâπÂà•„Ç®„É≥„Éá„Ç£„É≥„Ç∞„Éú„Çø„É≥ */}
                            {showTrueFinal && (
                                <div className="mb-6 p-6 bg-gradient-to-r from-yellow-500/20 to-red-500/20 border-2 border-yellow-500 rounded-2xl animate-pulse">
                                    <p className="text-2xl font-black text-yellow-400 mb-4">üéâ ÂÖ®„Ç®„É≥„Éá„Ç£„É≥„Ç∞ÈÅîÊàêÔºÅ</p>
                                    <button 
                                        onClick={() => {
                                            setIsGalleryOpen(false);
                                            handleChoice('ending_true_final');
                                        }}
                                        className="w-full px-8 py-4 bg-gradient-to-r from-red-600 to-pink-600 rounded-xl text-xl font-black shadow-2xl hover:scale-105 transition-all"
                                    >
                                        üî• TRUE ENDING „ÇíË¶ã„Çã üî•
                                    </button>
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto">
                                {Object.values(SCENARIO).filter(s => s.isEnding && !s.isTrueFinal).map((end, idx) => {
                                    const isCleared = clearedEndings.includes(end.name);
                                    return (
                                        <div key={idx} className={`p-6 rounded-2xl border-2 transition-all ${isCleared ? 'bg-white/5 border-yellow-500/50 shadow-lg' : 'bg-black border-white/5 opacity-40'}`}>
                                            <p className="text-xs text-white/40 mb-2">END NO. {idx + 1}</p>
                                            <p className={`text-xl font-bold ${isCleared ? 'text-yellow-400' : 'text-white/20'}`}>
                                                {isCleared ? end.name : '????????????'}
                                            </p>
                                            {isCleared && <p className="mt-4 text-sm opacity-60 line-clamp-2">{end.text}</p>}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
